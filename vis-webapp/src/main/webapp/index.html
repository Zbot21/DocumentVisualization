<!DOCTYPE html>
<!--
  ~ The MIT License (MIT)
  ~
  ~ Copyright (c) 2015 Chris Bellis, Chris Perry
  ~
  ~ Permission is hereby granted, free of charge, to any person obtaining a copy
  ~ of this software and associated documentation files (the "Software"), to deal
  ~ in the Software without restriction, including without limitation the rights
  ~ to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
  ~ copies of the Software, and to permit persons to whom the Software is
  ~ furnished to do so, subject to the following conditions:
  ~
  ~ The above copyright notice and this permission notice shall be included in
  ~ all copies or substantial portions of the Software.
  ~
  ~ THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  ~ IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  ~ FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
  ~ AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  ~ LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
  ~ OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
  ~ THE SOFTWARE.
  -->

<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="style/style.css"/>
    <link rel="stylesheet" type="text/css" href="style/results-style.css"/>
    <title>Tier 1 Visualization</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="js/multiTermGraph.js"></script>
    <script src="js/searchUtils.js"></script>
    <script>
        var onHideSidebar = null;
        function displayDocument(docId, callback) {
            if (onHideSidebar != null) onHideSidebar();
            var docInfo = document.getElementById("documentInfo");
            docInfo.innerHTML = "";
            $.get("last_doc?docId="+docId);
            displaySidebar();
            var additionalData = [function(resultDiv, docId){
                var link = document.createElement("a");
                link.innerHTML = "[SECOND_TIER]";
                link.setAttribute("href", "second_tier.html");
                link.setAttribute("target", "_blank");
                resultDiv.appendChild(link);
            }];
            appendMetadata(docInfo, docId, additionalData);
            onHideSidebar = callback;
        }

        $(document).ready(function () {
            document.getElementById("searchButton").addEventListener("click", createGraph);
            function createGraph() {
                // TODO: Prevent empty queries and allow for a variable number of queries.
                // TODO: Make the color of the queries deterministic with the color of the nodes.
                var chart = forceChart();
                var query1 = document.getElementById("query1").value;
                var query2 = document.getElementById("query2").value;
                var query3 = document.getElementById("query3").value;
                d3.json("multi_term_search?vis&query1=" + query1 + "&query2=" + query2 + "&query3=" + query3, function (error, data) {
                    if (error) throw error;
                    d3.select("#main").datum(data).call(chart);
                });
            }

            // Handle the enter key, because I am a lazy mother fucker
            $("#query1").keyup(function (event) {
                if (event.keyCode == 13) {
                    $("#searchButton").click();
                }
            });

            $("#query2").keyup(function (event) {
                if (event.keyCode == 13) {
                    $("#searchButton").click();
                }
            });

            $("#query3").keyup(function (event) {
                if (event.keyCode == 13) {
                    $("#searchButton").click();
                }
            });

        });

        function hideSidebar() {
            document.getElementById("infoBar").style.display = 'none';
            if (onHideSidebar != null) {
                onHideSidebar();
            }

        }

        function displaySidebar() {
            document.getElementById("infoBar").style.display = '';
        }


    </script>
</head>
<body>
<!--<div class="container">-->
<div class="sidebar" id="infoBar" style="display:none;">
    <input alt="Close" type="image" src="imgs/closeBtn.png" id="close" onclick="hideSidebar()">
    <div id="documentInfo"></div>
</div>
<div class="content" id="main"></div>
<br>
<div class="footer">
    <!-- TODO: These contain test values -->
    <div id="search-terms">
        <div class="term blue"><input class="input" id="query2" type="search" value="virtualization"/></div>
        <div class="term red"><input class="input" id="query1" type="search" value="visualization"/></div>
        <div class="term green"><input class="input" id="query3" type="search" value="test"/></div>
        <button style="width:99%; margin: 0 auto;" id="searchButton">Search</button>
    </div>


    <!--<div id="credit">-->
    <!--<p>Data Provided by <a href="http://research.google.com">Google Research</a></p>-->
    <!--</div>-->
</div>
<!--</div>-->

</body>
</html>